name: Example Deployment Workflow

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to deploy"
        required: false
        default: ""
      network:
        description: "Network to deploy to"
        required: false
        default: "Testnet"
        type: choice
        options:
          - Testnet
          - Mainnet
          - Devnet
      description:
        description: "Deployment description"
        required: false
        default: "Feature deployment"
      environment:
        description: "Deployment environment"
        required: false
        default: "staging"
        type: choice
        options:
          - staging
          - production
          - development

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Required for git history analysis

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build application
        run: npm run build

      - name: Deploy to environment
        run: |
          echo "üöÄ Deploying to ${{ github.event.inputs.environment }}"
          echo "üåø Branch: ${{ github.event.inputs.branch || github.ref_name }}"
          echo "üåê Network: ${{ github.event.inputs.network }}"
          # Your actual deployment logic here
          echo "‚úÖ Deployment completed successfully!"

      - name: Send deployment notification
        uses: ./
        with:
          slack-channel: "deployments"
          jira-base-url: "https://your-company.atlassian.net/browse/"
          jira-prefix: "PROJ"
          protected-branches: "main,develop,staging"
          network: ${{ github.event.inputs.network }}
          description: ${{ github.event.inputs.description }}

      - name: Deployment summary
        if: always()
        run: |
          echo "üéâ Deployment workflow completed!"
          echo "Branch: ${{ steps.deploy.outputs.branch_name || 'N/A' }}"
          echo "Network: ${{ github.event.inputs.network }}"
          echo "Environment: ${{ github.event.inputs.environment }}"
          echo "Author: ${{ github.actor }}"

          if [ "${{ steps.deploy.outputs.jira_tickets }}" != "" ]; then
            echo "Jira tickets: ${{ steps.deploy.outputs.jira_tickets }}"
          fi
